---
kind: KamajiControlPlane
apiVersion: controlplane.cluster.x-k8s.io/v1alpha1
metadata:
  name: {{ .Release.Name }}
  labels:
    {{- include "openstackcluster.labels" . | nindent 4 }}
  annotations:
    # Let CAPO do this in its chosen order.
    argocd.argoproj.io/sync-options: Delete=false
spec:
  version: "{{ .Values.version }}"
  replicas: {{ .Values.controlPlane.replicas }}
  dataStoreName: default
  addons:
    coreDNS: {}
    konnectivity: {}
  kubelet:
    preferredAddressTypes:
      - InternalIP
      - ExternalIP
      - Hostname
  network:
    serviceType: LoadBalancer
    serviceAnnotations:
      loadbalancer.openstack.org/floating-network-id: {{ .Values.openstack.externalNetworkID }}
  controllerManager:
    extraArgs:
    - --cloud-provider=external
  apiServer:
    extraArgs:
    - --cloud-provider=external  
